# ğŸ“Š Flujo del Sistema - Gimnasio Backend

Este documento describe los flujos principales del sistema con la estructura normalizada.

---

## ğŸ” 1. Flujo de AutenticaciÃ³n

### 1.1 Registro de Nuevo Usuario

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         REGISTRO DE USUARIO                                  â”‚
â”‚                                                                              â”‚
â”‚  Frontend                  Backend                      Base de Datos        â”‚
â”‚     â”‚                         â”‚                              â”‚               â”‚
â”‚     â”‚  POST /api/auth/registerâ”‚                              â”‚               â”‚
â”‚     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                              â”‚               â”‚
â”‚     â”‚  {nombre, apellido,     â”‚                              â”‚               â”‚
â”‚     â”‚   email, dni, password, â”‚                              â”‚               â”‚
â”‚     â”‚   genero, rol?}         â”‚                              â”‚               â”‚
â”‚     â”‚                         â”‚                              â”‚               â”‚
â”‚     â”‚                    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”                         â”‚               â”‚
â”‚     â”‚                    â”‚ Validar â”‚                         â”‚               â”‚
â”‚     â”‚                    â”‚ datos   â”‚                         â”‚               â”‚
â”‚     â”‚                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                         â”‚               â”‚
â”‚     â”‚                         â”‚                              â”‚               â”‚
â”‚     â”‚                    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”                         â”‚               â”‚
â”‚     â”‚                    â”‚Â¿Email o â”‚â”€â”€â”€â”€ SI â”€â–º 409 Conflict  â”‚               â”‚
â”‚     â”‚                    â”‚DNI      â”‚                         â”‚               â”‚
â”‚     â”‚                    â”‚duplicadoâ”‚                         â”‚               â”‚
â”‚     â”‚                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                         â”‚               â”‚
â”‚     â”‚                         â”‚ NO                           â”‚               â”‚
â”‚     â”‚                         â”‚                              â”‚               â”‚
â”‚     â”‚                    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚     â”‚                    â”‚      TRANSACCIÃ“N ATÃ“MICA                     â”‚    â”‚
â”‚     â”‚                    â”‚                                              â”‚    â”‚
â”‚     â”‚                    â”‚  1. INSERT INTO usuario                      â”‚    â”‚
â”‚     â”‚                    â”‚     (email, password, roles, activo)         â”‚    â”‚
â”‚     â”‚                    â”‚                    â–¼                         â”‚    â”‚
â”‚     â”‚                    â”‚  2. INSERT INTO persona                      â”‚    â”‚
â”‚     â”‚                    â”‚     (usuario_id, nombre, apellido,           â”‚    â”‚
â”‚     â”‚                    â”‚      dni, genero, telefono)                  â”‚    â”‚
â”‚     â”‚                    â”‚                    â–¼                         â”‚    â”‚
â”‚     â”‚                    â”‚  3. INSERT INTO cliente/empleado             â”‚    â”‚
â”‚     â”‚                    â”‚     (persona_id, usuario_id, ...)            â”‚    â”‚
â”‚     â”‚                    â”‚                                              â”‚    â”‚
â”‚     â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚     â”‚                         â”‚                              â”‚               â”‚
â”‚     â”‚                    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”                         â”‚               â”‚
â”‚     â”‚                    â”‚ Enviar  â”‚                         â”‚               â”‚
â”‚     â”‚                    â”‚ Email   â”‚                         â”‚               â”‚
â”‚     â”‚                    â”‚ Welcome â”‚                         â”‚               â”‚
â”‚     â”‚                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                         â”‚               â”‚
â”‚     â”‚                         â”‚                              â”‚               â”‚
â”‚     â”‚                    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”                         â”‚               â”‚
â”‚     â”‚                    â”‚ Otorgar â”‚                         â”‚               â”‚
â”‚     â”‚                    â”‚ Puntos  â”‚                         â”‚               â”‚
â”‚     â”‚                    â”‚Fidelidadâ”‚                         â”‚               â”‚
â”‚     â”‚                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                         â”‚               â”‚
â”‚     â”‚                         â”‚                              â”‚               â”‚
â”‚     â”‚  201 Created + JWT      â”‚                              â”‚               â”‚
â”‚     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                              â”‚               â”‚
â”‚     â”‚                         â”‚                              â”‚               â”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 Login con 2FA (Administrador)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         LOGIN CON 2FA                                        â”‚
â”‚                                                                              â”‚
â”‚  Frontend                  Backend                      Email Service        â”‚
â”‚     â”‚                         â”‚                              â”‚               â”‚
â”‚     â”‚  POST /api/auth/login   â”‚                              â”‚               â”‚
â”‚     â”‚  {emailOrDni, password} â”‚                              â”‚               â”‚
â”‚     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                              â”‚               â”‚
â”‚     â”‚                         â”‚                              â”‚               â”‚
â”‚     â”‚                    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”                         â”‚               â”‚
â”‚     â”‚                    â”‚ Buscar  â”‚                         â”‚               â”‚
â”‚     â”‚                    â”‚ Usuario â”‚                         â”‚               â”‚
â”‚     â”‚                    â”‚por emailâ”‚                         â”‚               â”‚
â”‚     â”‚                    â”‚ o DNI   â”‚                         â”‚               â”‚
â”‚     â”‚                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                         â”‚               â”‚
â”‚     â”‚                         â”‚                              â”‚               â”‚
â”‚     â”‚                    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”                         â”‚               â”‚
â”‚     â”‚                    â”‚Verificarâ”‚                         â”‚               â”‚
â”‚     â”‚                    â”‚password â”‚                         â”‚               â”‚
â”‚     â”‚                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                         â”‚               â”‚
â”‚     â”‚                         â”‚                              â”‚               â”‚
â”‚     â”‚                    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”                         â”‚               â”‚
â”‚     â”‚                    â”‚ Â¿Es     â”‚â”€â”€â”€â”€NOâ”€â”€â”€â”€â–º Generar JWT  â”‚               â”‚
â”‚     â”‚                    â”‚  ADMIN? â”‚            y retornar   â”‚               â”‚
â”‚     â”‚                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                         â”‚               â”‚
â”‚     â”‚                         â”‚ SI                           â”‚               â”‚
â”‚     â”‚                         â”‚                              â”‚               â”‚
â”‚     â”‚                    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”  Enviar cÃ³digo 6 dÃ­gitosâ”‚               â”‚
â”‚     â”‚                    â”‚ Generar â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚               â”‚
â”‚     â”‚                    â”‚cÃ³digo2FAâ”‚                         â”‚               â”‚
â”‚     â”‚                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                         â”‚               â”‚
â”‚     â”‚                         â”‚                              â”‚               â”‚
â”‚     â”‚  {requires2FA: true}    â”‚                              â”‚               â”‚
â”‚     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                              â”‚               â”‚
â”‚     â”‚                         â”‚                              â”‚               â”‚
â”‚     â”‚  POST /api/auth/verify-2fa                             â”‚               â”‚
â”‚     â”‚  {email, code}          â”‚                              â”‚               â”‚
â”‚     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                              â”‚               â”‚
â”‚     â”‚                         â”‚                              â”‚               â”‚
â”‚     â”‚                    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”                         â”‚               â”‚
â”‚     â”‚                    â”‚Verificarâ”‚                         â”‚               â”‚
â”‚     â”‚                    â”‚ cÃ³digo  â”‚                         â”‚               â”‚
â”‚     â”‚                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                         â”‚               â”‚
â”‚     â”‚                         â”‚                              â”‚               â”‚
â”‚     â”‚  200 OK + JWT Token     â”‚                              â”‚               â”‚
â”‚     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                              â”‚               â”‚
â”‚     â”‚                         â”‚                              â”‚               â”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’³ 2. Flujo de MembresÃ­a y Pago

### 2.1 AdquisiciÃ³n de MembresÃ­a

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ADQUISICIÃ“N DE MEMBRESÃA                                  â”‚
â”‚                                                                              â”‚
â”‚  Cliente           Recepcionista          Backend              Notificacionesâ”‚
â”‚     â”‚                    â”‚                   â”‚                      â”‚        â”‚
â”‚     â”‚  1. "Quiero        â”‚                   â”‚                      â”‚        â”‚
â”‚     â”‚   inscribirme"     â”‚                   â”‚                      â”‚        â”‚
â”‚     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                   â”‚                      â”‚        â”‚
â”‚     â”‚                    â”‚                   â”‚                      â”‚        â”‚
â”‚     â”‚                    â”‚  GET /api/planes/activos                 â”‚        â”‚
â”‚     â”‚                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                      â”‚        â”‚
â”‚     â”‚                    â”‚                   â”‚                      â”‚        â”‚
â”‚     â”‚                    â”‚  [Lista de planes]â”‚                      â”‚        â”‚
â”‚     â”‚                    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                      â”‚        â”‚
â”‚     â”‚                    â”‚                   â”‚                      â”‚        â”‚
â”‚     â”‚  2. "Quiero el     â”‚                   â”‚                      â”‚        â”‚
â”‚     â”‚   Plan Mensual"    â”‚                   â”‚                      â”‚        â”‚
â”‚     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                   â”‚                      â”‚        â”‚
â”‚     â”‚                    â”‚                   â”‚                      â”‚        â”‚
â”‚     â”‚                    â”‚  POST /api/membresias/crear              â”‚        â”‚
â”‚     â”‚                    â”‚  {usuarioId, planId}                     â”‚        â”‚
â”‚     â”‚                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                      â”‚        â”‚
â”‚     â”‚                    â”‚                   â”‚                      â”‚        â”‚
â”‚     â”‚                    â”‚                   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚        â”‚
â”‚     â”‚                    â”‚                   â”‚  â”‚ Crear MembresÃ­aâ”‚  â”‚        â”‚
â”‚     â”‚                    â”‚                   â”‚  â”‚ estado: PENDINGâ”‚  â”‚        â”‚
â”‚     â”‚                    â”‚                   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚        â”‚
â”‚     â”‚                    â”‚                   â”‚                      â”‚        â”‚
â”‚     â”‚                    â”‚  {membresiaId, estado: PENDING}         â”‚        â”‚
â”‚     â”‚                    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                      â”‚        â”‚
â”‚     â”‚                    â”‚                   â”‚                      â”‚        â”‚
â”‚     â”‚                    â”‚  POST /api/pagos/registrar               â”‚        â”‚
â”‚     â”‚                    â”‚  {usuarioId, planId, metodoPago}         â”‚        â”‚
â”‚     â”‚                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                      â”‚        â”‚
â”‚     â”‚                    â”‚                   â”‚                      â”‚        â”‚
â”‚     â”‚                    â”‚                   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚        â”‚
â”‚     â”‚                    â”‚                   â”‚  â”‚ Crear Pago     â”‚  â”‚        â”‚
â”‚     â”‚                    â”‚                   â”‚  â”‚ estado: PENDINGâ”‚  â”‚        â”‚
â”‚     â”‚                    â”‚                   â”‚  â”‚ + PaymentCode  â”‚  â”‚        â”‚
â”‚     â”‚                    â”‚                   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚        â”‚
â”‚     â”‚                    â”‚                   â”‚                      â”‚        â”‚
â”‚     â”‚                    â”‚  {pagoId, paymentCode, qrUrl}            â”‚        â”‚
â”‚     â”‚                    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                      â”‚        â”‚
â”‚     â”‚                    â”‚                   â”‚                      â”‚        â”‚
â”‚     â”‚  3. Muestra QR     â”‚                   â”‚                      â”‚        â”‚
â”‚     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚                      â”‚        â”‚
â”‚     â”‚                    â”‚                   â”‚                      â”‚        â”‚
â”‚     â”‚  4. Paga con       â”‚                   â”‚                      â”‚        â”‚
â”‚     â”‚     Yape/Plin      â”‚                   â”‚                      â”‚        â”‚
â”‚     â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚                   â”‚                      â”‚        â”‚
â”‚     â”‚                    â”‚                   â”‚                      â”‚        â”‚
â”‚     â”‚  5. "Ya paguÃ©,     â”‚                   â”‚                      â”‚        â”‚
â”‚     â”‚   cÃ³digo: ABC123"  â”‚                   â”‚                      â”‚        â”‚
â”‚     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                   â”‚                      â”‚        â”‚
â”‚     â”‚                    â”‚                   â”‚                      â”‚        â”‚
â”‚     â”‚                    â”‚  POST /api/pagos/{id}/confirmar          â”‚        â”‚
â”‚     â”‚                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                      â”‚        â”‚
â”‚     â”‚                    â”‚                   â”‚                      â”‚        â”‚
â”‚     â”‚                    â”‚                   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚        â”‚
â”‚     â”‚                    â”‚                   â”‚  â”‚ Confirmar Pago â”‚  â”‚        â”‚
â”‚     â”‚                    â”‚                   â”‚  â”‚ Activar        â”‚  â”‚        â”‚
â”‚     â”‚                    â”‚                   â”‚  â”‚   MembresÃ­a    â”‚  â”‚        â”‚
â”‚     â”‚                    â”‚                   â”‚  â”‚ Generar        â”‚  â”‚        â”‚
â”‚     â”‚                    â”‚                   â”‚  â”‚  Comprobante   â”‚  â”‚        â”‚
â”‚     â”‚                    â”‚                   â”‚  â”‚ Otorgar Puntos â”‚  â”‚        â”‚
â”‚     â”‚                    â”‚                   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚        â”‚
â”‚     â”‚                    â”‚                   â”‚          â”‚           â”‚        â”‚
â”‚     â”‚                    â”‚                   â”‚          â”‚  Enviar   â”‚        â”‚
â”‚     â”‚                    â”‚                   â”‚          â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚        â”‚
â”‚     â”‚                    â”‚                   â”‚          â”‚NotificaciÃ³n        â”‚
â”‚     â”‚                    â”‚                   â”‚                      â”‚        â”‚
â”‚     â”‚                    â”‚  200 OK           â”‚                      â”‚        â”‚
â”‚     â”‚                    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                      â”‚        â”‚
â”‚     â”‚                    â”‚                   â”‚                      â”‚        â”‚
â”‚     â”‚  6. "Listo, su     â”‚                   â”‚                      â”‚        â”‚
â”‚     â”‚   membresÃ­a estÃ¡   â”‚                   â”‚                      â”‚        â”‚
â”‚     â”‚   activa"          â”‚                   â”‚                      â”‚        â”‚
â”‚     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚                      â”‚        â”‚
â”‚     â”‚                    â”‚                   â”‚                      â”‚        â”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸšª 3. Flujo de Asistencia

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         REGISTRO DE ASISTENCIA                               â”‚
â”‚                                                                              â”‚
â”‚  Cliente           Recepcionista          Backend              Fidelidad     â”‚
â”‚     â”‚                    â”‚                   â”‚                      â”‚        â”‚
â”‚     â”‚  1. Muestra DNI    â”‚                   â”‚                      â”‚        â”‚
â”‚     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                   â”‚                      â”‚        â”‚
â”‚     â”‚                    â”‚                   â”‚                      â”‚        â”‚
â”‚     â”‚                    â”‚  GET /api/usuarios/dni/{dni}             â”‚        â”‚
â”‚     â”‚                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                      â”‚        â”‚
â”‚     â”‚                    â”‚                   â”‚                      â”‚        â”‚
â”‚     â”‚                    â”‚  {usuario + persona + cliente}           â”‚        â”‚
â”‚     â”‚                    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                      â”‚        â”‚
â”‚     â”‚                    â”‚                   â”‚                      â”‚        â”‚
â”‚     â”‚                    â”‚  GET /api/membresias/usuario/{id}/activa â”‚        â”‚
â”‚     â”‚                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                      â”‚        â”‚
â”‚     â”‚                    â”‚                   â”‚                      â”‚        â”‚
â”‚     â”‚                    â”‚              â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”                 â”‚        â”‚
â”‚     â”‚                    â”‚              â”‚Â¿Tiene   â”‚                 â”‚        â”‚
â”‚     â”‚                    â”‚              â”‚membresÃ­aâ”‚                 â”‚        â”‚
â”‚     â”‚                    â”‚              â”‚ activa? â”‚                 â”‚        â”‚
â”‚     â”‚                    â”‚              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                 â”‚        â”‚
â”‚     â”‚                    â”‚                   â”‚                      â”‚        â”‚
â”‚     â”‚              â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”                â”‚        â”‚
â”‚     â”‚              â”‚           â”‚       â”‚           â”‚                â”‚        â”‚
â”‚     â”‚              â–¼ SI        â”‚       â–¼ NO        â”‚                â”‚        â”‚
â”‚     â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚        â”‚
â”‚     â”‚   â”‚ POST /api/     â”‚     â”‚    â”‚ 403 Forbidden  â”‚              â”‚        â”‚
â”‚     â”‚   â”‚  asistencias/  â”‚     â”‚    â”‚ "MembresÃ­a no  â”‚              â”‚        â”‚
â”‚     â”‚   â”‚  registrar     â”‚     â”‚    â”‚  activa"       â”‚              â”‚        â”‚
â”‚     â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚        â”‚
â”‚     â”‚           â”‚              â”‚                                    â”‚        â”‚
â”‚     â”‚           â–¼              â”‚                                    â”‚        â”‚
â”‚     â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚                                    â”‚        â”‚
â”‚     â”‚   â”‚ Registrar      â”‚     â”‚                                    â”‚        â”‚
â”‚     â”‚   â”‚ ENTRADA/SALIDA â”‚     â”‚                                    â”‚        â”‚
â”‚     â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚                                    â”‚        â”‚
â”‚     â”‚           â”‚              â”‚                                    â”‚        â”‚
â”‚     â”‚           â–¼              â”‚     Otorgar puntos                 â”‚        â”‚
â”‚     â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚     por asistencia                 â”‚        â”‚
â”‚     â”‚   â”‚ Verificar      â”‚â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚        â”‚
â”‚     â”‚   â”‚ Rachas y       â”‚     â”‚                                    â”‚        â”‚
â”‚     â”‚   â”‚ Bonus          â”‚     â”‚                                    â”‚        â”‚
â”‚     â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚                                    â”‚        â”‚
â”‚     â”‚           â”‚              â”‚                                    â”‚        â”‚
â”‚     â”‚    200 OK â”‚              â”‚                                    â”‚        â”‚
â”‚     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                                    â”‚        â”‚
â”‚     â”‚           â”‚              â”‚                                    â”‚        â”‚
â”‚     â”‚  2. "Bienvenido,  â”‚      â”‚                                    â”‚        â”‚
â”‚     â”‚   puede pasar"    â”‚      â”‚                                    â”‚        â”‚
â”‚     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚      â”‚                                    â”‚        â”‚
â”‚     â”‚                   â”‚      â”‚                                    â”‚        â”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ† 4. Flujo de Sistema de Fidelidad

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SISTEMA DE FIDELIDAD                                    â”‚
â”‚                                                                              â”‚
â”‚  ACCIONES QUE OTORGAN PUNTOS:                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚  â€¢ REGISTRO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ +100 puntos    â”‚   â”‚
â”‚  â”‚  â€¢ PAGO_MEMBRESIA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ +50 puntos     â”‚   â”‚
â”‚  â”‚  â€¢ ASISTENCIA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ +10 puntos     â”‚   â”‚
â”‚  â”‚  â€¢ ASISTENCIA_SEMANA_COMPLETA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ +50 puntos     â”‚   â”‚
â”‚  â”‚  â€¢ REFERIDO_REGISTRADO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ +200 puntos    â”‚   â”‚
â”‚  â”‚  â€¢ REFERIDO_MEMBRESIA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ +300 puntos    â”‚   â”‚
â”‚  â”‚  â€¢ CUMPLEAÃ‘OS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ +100 puntos    â”‚   â”‚
â”‚  â”‚  â€¢ ANIVERSARIO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ +150 puntos    â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  NIVELES:                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚   BRONCE      PLATA       ORO         PLATINO      DIAMANTE          â”‚   â”‚
â”‚  â”‚   0-999       1000-4999   5000-9999   10000-19999  20000+            â”‚   â”‚
â”‚  â”‚     â”‚            â”‚           â”‚            â”‚            â”‚              â”‚   â”‚
â”‚  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚   â”‚
â”‚  â”‚            ProgresiÃ³n automÃ¡tica segÃºn puntos acumulados              â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  FLUJO DE CANJE:                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚   Cliente            Backend               NotificaciÃ³n               â”‚   â”‚
â”‚  â”‚      â”‚                  â”‚                       â”‚                     â”‚   â”‚
â”‚  â”‚      â”‚ GET /fidelidad/recompensas              â”‚                     â”‚   â”‚
â”‚  â”‚      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                       â”‚                     â”‚   â”‚
â”‚  â”‚      â”‚                  â”‚                       â”‚                     â”‚   â”‚
â”‚  â”‚      â”‚  [Recompensas disponibles]              â”‚                     â”‚   â”‚
â”‚  â”‚      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                       â”‚                     â”‚   â”‚
â”‚  â”‚      â”‚                  â”‚                       â”‚                     â”‚   â”‚
â”‚  â”‚      â”‚ POST /fidelidad/canjear                 â”‚                     â”‚   â”‚
â”‚  â”‚      â”‚ {recompensaId}   â”‚                       â”‚                     â”‚   â”‚
â”‚  â”‚      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                       â”‚                     â”‚   â”‚
â”‚  â”‚      â”‚                  â”‚                       â”‚                     â”‚   â”‚
â”‚  â”‚      â”‚            â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”                â”‚                     â”‚   â”‚
â”‚  â”‚      â”‚            â”‚ Verificar â”‚                â”‚                     â”‚   â”‚
â”‚  â”‚      â”‚            â”‚ puntos    â”‚                â”‚                     â”‚   â”‚
â”‚  â”‚      â”‚            â”‚ suficientesâ”‚                â”‚                     â”‚   â”‚
â”‚  â”‚      â”‚            â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                â”‚                     â”‚   â”‚
â”‚  â”‚      â”‚                  â”‚                       â”‚                     â”‚   â”‚
â”‚  â”‚      â”‚            â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”   Enviar       â”‚                     â”‚   â”‚
â”‚  â”‚      â”‚            â”‚ Descontar â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                     â”‚   â”‚
â”‚  â”‚      â”‚            â”‚ puntos    â”‚  notificaciÃ³n  â”‚                     â”‚   â”‚
â”‚  â”‚      â”‚            â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                â”‚                     â”‚   â”‚
â”‚  â”‚      â”‚                  â”‚                       â”‚                     â”‚   â”‚
â”‚  â”‚      â”‚  {canje confirmado}                     â”‚                     â”‚   â”‚
â”‚  â”‚      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                       â”‚                     â”‚   â”‚
â”‚  â”‚      â”‚                  â”‚                       â”‚                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ‹ï¸ 5. Flujo de Rutinas y Progreso

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FLUJO DE RUTINAS Y PROGRESO                               â”‚
â”‚                                                                              â”‚
â”‚  Cliente/App          Backend                    Base de Datos               â”‚
â”‚     â”‚                    â”‚                            â”‚                      â”‚
â”‚     â”‚  GET /api/rutinas/me                            â”‚                      â”‚
â”‚     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                            â”‚                      â”‚
â”‚     â”‚                    â”‚  SELECT * FROM rutinas     â”‚                      â”‚
â”‚     â”‚                    â”‚  WHERE usuario_id = X      â”‚                      â”‚
â”‚     â”‚                    â”‚  AND activa = true         â”‚                      â”‚
â”‚     â”‚                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                      â”‚
â”‚     â”‚                    â”‚                            â”‚                      â”‚
â”‚     â”‚  {rutina con dÃ­as y ejercicios}                â”‚                      â”‚
â”‚     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                            â”‚                      â”‚
â”‚     â”‚                    â”‚                            â”‚                      â”‚
â”‚     â”‚ POST /api/progreso/iniciar                     â”‚                      â”‚
â”‚     â”‚ {diaRutinaId}      â”‚                            â”‚                      â”‚
â”‚     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                            â”‚                      â”‚
â”‚     â”‚                    â”‚  Crear RegistroEntrenamiento                      â”‚
â”‚     â”‚                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                      â”‚
â”‚     â”‚                    â”‚                            â”‚                      â”‚
â”‚     â”‚  {registroId, ejercicios a completar}          â”‚                      â”‚
â”‚     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                            â”‚                      â”‚
â”‚     â”‚                    â”‚                            â”‚                      â”‚
â”‚     â”‚  [Realiza ejercicios...]                       â”‚                      â”‚
â”‚     â”‚                    â”‚                            â”‚                      â”‚
â”‚     â”‚ POST /api/progreso/{id}/finalizar              â”‚                      â”‚
â”‚     â”‚ {ejerciciosCompletados[], notas}               â”‚                      â”‚
â”‚     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                            â”‚                      â”‚
â”‚     â”‚                    â”‚                            â”‚                      â”‚
â”‚     â”‚                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚                      â”‚
â”‚     â”‚                    â”‚  â”‚ Guardar progreso      â”‚â”‚                      â”‚
â”‚     â”‚                    â”‚  â”‚ Calcular estadÃ­sticas â”‚â”‚                      â”‚
â”‚     â”‚                    â”‚  â”‚ Actualizar rachas     â”‚â”‚                      â”‚
â”‚     â”‚                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚                      â”‚
â”‚     â”‚                    â”‚                            â”‚                      â”‚
â”‚     â”‚ GET /api/progreso/estadisticas                 â”‚                      â”‚
â”‚     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                            â”‚                      â”‚
â”‚     â”‚                    â”‚                            â”‚                      â”‚
â”‚     â”‚  {totalSesiones, duracionPromedio,             â”‚                      â”‚
â”‚     â”‚   rachaActual, mejorRacha, ...}                â”‚                      â”‚
â”‚     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                            â”‚                      â”‚
â”‚     â”‚                    â”‚                            â”‚                      â”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“… 6. Flujo de Clases y Reservas

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FLUJO DE RESERVA DE CLASE                                 â”‚
â”‚                                                                              â”‚
â”‚  Cliente             Backend                Instructor        Notificaciones â”‚
â”‚     â”‚                   â”‚                       â”‚                   â”‚        â”‚
â”‚     â”‚ GET /api/clases/horarios                  â”‚                   â”‚        â”‚
â”‚     â”‚ ?fecha=2024-01-15 â”‚                       â”‚                   â”‚        â”‚
â”‚     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                       â”‚                   â”‚        â”‚
â”‚     â”‚                   â”‚                       â”‚                   â”‚        â”‚
â”‚     â”‚ [{sesionId, tipoClase, hora,             â”‚                   â”‚        â”‚
â”‚     â”‚   instructor, cuposDisponibles}]         â”‚                   â”‚        â”‚
â”‚     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                       â”‚                   â”‚        â”‚
â”‚     â”‚                   â”‚                       â”‚                   â”‚        â”‚
â”‚     â”‚ POST /api/clases/reservar                â”‚                   â”‚        â”‚
â”‚     â”‚ {sesionId}        â”‚                       â”‚                   â”‚        â”‚
â”‚     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                       â”‚                   â”‚        â”‚
â”‚     â”‚                   â”‚                       â”‚                   â”‚        â”‚
â”‚     â”‚              â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”                 â”‚                   â”‚        â”‚
â”‚     â”‚              â”‚Â¿Cupos   â”‚                 â”‚                   â”‚        â”‚
â”‚     â”‚              â”‚disponib?â”‚                 â”‚                   â”‚        â”‚
â”‚     â”‚              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                 â”‚                   â”‚        â”‚
â”‚     â”‚                   â”‚                       â”‚                   â”‚        â”‚
â”‚     â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚                   â”‚        â”‚
â”‚     â”‚         â–¼                   â–¼            â”‚                   â”‚        â”‚
â”‚     â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚                   â”‚        â”‚
â”‚     â”‚   â”‚   SI     â”‚        â”‚   NO     â”‚       â”‚                   â”‚        â”‚
â”‚     â”‚   â”‚ Reservar â”‚        â”‚ Error    â”‚       â”‚                   â”‚        â”‚
â”‚     â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚                   â”‚        â”‚
â”‚     â”‚        â”‚                                  â”‚                   â”‚        â”‚
â”‚     â”‚        â”‚  Notificar nueva reserva        â”‚                   â”‚        â”‚
â”‚     â”‚        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                   â”‚        â”‚
â”‚     â”‚        â”‚                                  â”‚                   â”‚        â”‚
â”‚     â”‚        â”‚                                  â”‚  Enviar           â”‚        â”‚
â”‚     â”‚        â”‚                                  â”‚  confirmaciÃ³n     â”‚        â”‚
â”‚     â”‚        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚        â”‚
â”‚     â”‚        â”‚                                  â”‚                   â”‚        â”‚
â”‚     â”‚ {reservaId, estado: CONFIRMADA}          â”‚                   â”‚        â”‚
â”‚     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”‚                                  â”‚                   â”‚        â”‚
â”‚     â”‚        â”‚                                  â”‚                   â”‚        â”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š 7. Flujo de Reportes

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FLUJO DE REPORTES                                    â”‚
â”‚                                                                              â”‚
â”‚  Admin/Contador        Backend                    ExportaciÃ³n                â”‚
â”‚     â”‚                     â”‚                           â”‚                      â”‚
â”‚     â”‚ GET /api/reportes/dashboard                     â”‚                      â”‚
â”‚     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                           â”‚                      â”‚
â”‚     â”‚                     â”‚                           â”‚                      â”‚
â”‚     â”‚                â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”                      â”‚                      â”‚
â”‚     â”‚                â”‚ Agregar â”‚                      â”‚                      â”‚
â”‚     â”‚                â”‚ datos   â”‚                      â”‚                      â”‚
â”‚     â”‚                â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                      â”‚                      â”‚
â”‚     â”‚                     â”‚                           â”‚                      â”‚
â”‚     â”‚ {                   â”‚                           â”‚                      â”‚
â”‚     â”‚   ingresosMensuales,â”‚                           â”‚                      â”‚
â”‚     â”‚   clientesActivos,  â”‚                           â”‚                      â”‚
â”‚     â”‚   topPlanes,        â”‚                           â”‚                      â”‚
â”‚     â”‚   asistenciasHoy,   â”‚                           â”‚                      â”‚
â”‚     â”‚   membresiasPorEstado,                          â”‚                      â”‚
â”‚     â”‚   ...               â”‚                           â”‚                      â”‚
â”‚     â”‚ }                   â”‚                           â”‚                      â”‚
â”‚     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                           â”‚                      â”‚
â”‚     â”‚                     â”‚                           â”‚                      â”‚
â”‚     â”‚ GET /api/reportes/exportar/excel               â”‚                      â”‚
â”‚     â”‚ ?tipo=ingresos&mes=12&anio=2024                â”‚                      â”‚
â”‚     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                           â”‚                      â”‚
â”‚     â”‚                     â”‚                           â”‚                      â”‚
â”‚     â”‚                     â”‚  Generar archivo          â”‚                      â”‚
â”‚     â”‚                     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚                      â”‚
â”‚     â”‚                     â”‚                           â”‚                      â”‚
â”‚     â”‚ Content-Type: application/excel                â”‚                      â”‚
â”‚     â”‚ [archivo.xlsx]      â”‚                           â”‚                      â”‚
â”‚     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                           â”‚                      â”‚
â”‚     â”‚                     â”‚                           â”‚                      â”‚
â”‚     â”‚ GET /api/reportes/exportar/pdf                 â”‚                      â”‚
â”‚     â”‚ ?tipo=membresias    â”‚                           â”‚                      â”‚
â”‚     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                           â”‚                      â”‚
â”‚     â”‚                     â”‚                           â”‚                      â”‚
â”‚     â”‚ Content-Type: application/pdf                  â”‚                      â”‚
â”‚     â”‚ [reporte.pdf]       â”‚                           â”‚                      â”‚
â”‚     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                           â”‚                      â”‚
â”‚     â”‚                     â”‚                           â”‚                      â”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ 8. Tareas Programadas (Schedulers)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      TAREAS PROGRAMADAS                                      â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  @Scheduled(cron = "0 0 0 * * *")  // Cada dÃ­a a medianoche         â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚ MembresiaUseCase.vencerMembresiasAutomaticamente()           â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Buscar membresÃ­as con fechaFin < hoy                      â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Cambiar estado a VENCIDA                                  â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Registrar en historial                                    â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Enviar notificaciÃ³n al usuario                            â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  @Scheduled(cron = "0 */5 * * * *")  // Cada 5 minutos              â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚ PaymentCodeUseCase.expirarCodigosVencidos()                  â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Buscar cÃ³digos con fechaExpiracion < ahora                â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Cambiar estado a EXPIRADO                                 â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  @Scheduled(cron = "0 0 9 * * *")  // Cada dÃ­a a las 9am            â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚ FidelidadUseCase.otorgarPuntosCumpleanos()                   â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Buscar usuarios que cumplen aÃ±os hoy                      â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Otorgar puntos de cumpleaÃ±os                              â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Enviar notificaciÃ³n de felicitaciÃ³n                       â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  @Scheduled(cron = "0 0 8 * * *")  // Cada dÃ­a a las 8am            â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚ NotificacionUseCase.enviarRecordatorioVencimiento()          â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Buscar membresÃ­as por vencer en 3 dÃ­as                    â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Enviar notificaciÃ³n de recordatorio                       â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ Notas Adicionales

### Transacciones
Todas las operaciones crÃ­ticas usan `@Transactional` para garantizar la integridad de los datos.

### AuditorÃ­a
Los campos `fechaCreacion` y `fechaActualizacion` se manejan automÃ¡ticamente con `@PrePersist` y `@PreUpdate`.

### Seguridad
Todos los endpoints (excepto auth y planes pÃºblicos) requieren autenticaciÃ³n JWT.

---

**Ãšltima actualizaciÃ³n:** Diciembre 2024
